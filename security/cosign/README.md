# Cosign

Cosign is used in this cluster to sign containers and binaries going to [Harbor](../../storage/harbor/README.md). There isn't any infrastructure in this part of the repo per se. Only secrets for Cosign are dealt with here.

For example, storing the private key for uses around the cluster, like [Argo Workflows](../../ci-cd/argo-workflows/README.md) so that pipelines may push signatures to Harbor containers.

## Generating a Key Pair

If starting from fresh, a [Cosign key pair will need to be created](https://docs.sigstore.dev/cosign/key_management/signing_with_self-managed_keys/). To do so, run:

```bash
export COSIGN_PASSWORD='XXXXXXXXXXXXXXXXXXXXX'
cosign generate-key-pair
```

This will generate two files:

1. `cosign.key`
2. `cosign.pub`

Within [Vault](../vault/README.md) save the key under: `vault/secrets/kubernetes-homelab/kv/cosign/key-pair`. Make a key for the following:

1. `COSIGN_PASSWORD`: the password exported above.
2. `cosign.key`: the `cosign.key` file generated by Cosign.
3. `cosign.pub`: the `cosign.pub` file generated by Cosign.

The cluster will then use this as a secret via [ESO](../external-secrets-operator/README.md).

